{"version":3,"file":"react-fakelist.umd.js","sources":["../../src/hook/is.function.js","../../src/hook/fake.body.ref.js","../../src/hook/useFakeList.js"],"sourcesContent":["// simple check for function type, inspired by lodash\nconst isFunction = (obj) => {\n  return !!(obj && obj.constructor && obj.call && obj.apply);\n}\nexport default isFunction;","// Fake body ref to ensure consistency\nconst BodyElement = {\n    getBoundingClientRect: ()=>{\n      // returm document.documentElement datas\n      return document.body.getBoundingClientRect()\n    },\n    addEventListener: (type, cllbck)=>{\n      window.addEventListener(type, cllbck);\n    },\n    removeEventListener:(type, cllbck)=>{\n      window.removeEventListener(type, cllbck);\n    },\n    __str__: 'Body Element'\n};\n\nObject.defineProperties(BodyElement, {\n  'scrollTop': {\n    get:()=> window.scrollY\n  },\n  'clientHeight': {\n    get:()=> document.documentElement.clientHeight\n  }\n});\nconst BODY_REF={\n  current: BodyElement\n}\nexport default BODY_REF;","// a Hook to fake large list\nimport React from \"react\";\nimport isFunction from './is.function';\nimport BODY_REF from './fake.body.ref';\nconst TRUTHY = ()=> true;\n\nconst DEFAULT_OPTIONS = {\n  id: 'fake-list', // a custom id, if used more than once in a page\n  approximateElementHeight: 80, // approximated height for a component\n  overhead: 3, // number of offscreen elements to draw\n  assumeHeightIsConstant: true, // if true, will precalculate position based on approximateElementHeight\n  // but will not be responsive. If set to false, let onResize event do **heavy** calculations\n}\n\nexport default function useFakeList(\n  datas = [], // full list to display\n  scrollerRef = BODY_REF, // the component that scroll, if undefined, will use window\n  renderElement, // a function taking datas element param for rendering\n  options = DEFAULT_OPTIONS, // some informations on elements,\n  validateItem = TRUTHY, // if return false, will not display this item\n) {\n  const [dataItems, setDataItems] = React.useState([]);\n  const [refresh, setRefresh] = React.useState(0); // will serve as refresher on scroll\n  const [config] = React.useState({...DEFAULT_OPTIONS, ...options});\n  const approxHeight = config.approximateElementHeight;\n  React.useEffect(() => {\n    /* istanbul ignore else no work */\n    if (scrollerRef.current) {\n      // when ref got something, we can start drawing items\n      setDataItems(datas)\n    }\n  },[scrollerRef.current]);\n  React.useEffect(()=>{\n    let i = 0;\n    let current = scrollerRef.current;\n    /* istanbul ignore if no work */\n    if(!current) return;\n    const onScroll = ()=>{\n      // if scroll more than approxHeight => redraw\n      /* istanbul ignore else no work */\n      if(Math.abs(current.scrollTop - i) > approxHeight){\n        i=current.scrollTop;\n        setRefresh(i);          \n      }\n        \n      };\n    current.addEventListener('scroll',onScroll);\n    return ()=>{\n      current.removeEventListener('scroll', onScroll)\n    }\n  },[scrollerRef.current, approxHeight]);\n  \n  const renderList = React.useMemo(()=>{\n    /* istanbul ignore else dummy users */\n    if(isFunction(renderElement) && scrollerRef.current){\n      const datas = dataItems || [];\n      // const scrollerSize = scrollerRef.current.getBoundingClientRect();\n      const {id, approximateElementHeight, overhead} = config;\n      \n      // simple: do all array and display on need\n      // if full window => top, if !fullWindow => scrollTop\n      let topPos =  - scrollerRef.current.scrollTop; \n      let count = datas.length;\n      let pos = topPos; // position of 1st element in pixels\n      let topHeight = 0; // heights of fakers div\n      let bottomHeight = 0;\n      let items = [];\n      const MIN_POS_X = - overhead * approximateElementHeight;\n      const MAX_POS_X = scrollerRef.current.clientHeight + overhead * approximateElementHeight;\n\n      // console.log(MAX_POS_X, scrollerRef.current.clientHeight,scrollerSize, scrollerRef.current.scrollTop);\n      let origin = 0;\n      // from refresh, assume we are constantSizeItem=true ---------------\n      if(config.assumeHeightIsConstant){\n        // calculate 1st index\n        origin = Math.floor( refresh / config.approximateElementHeight) - config.overhead;\n        origin = origin < 0 ? 0 : origin;\n        // add to top position\n        topHeight = origin * config.approximateElementHeight;\n        pos += topHeight;\n      } else {\n        // need to take onResize into account\n        // @TODO\n      }      \n      // end of assuming --------------------------------------------------\n\n      for(let i=origin; i< count; i++){\n          if(pos + approximateElementHeight < MIN_POS_X){\n            // add to top\n            topHeight += approximateElementHeight;\n          } else if (pos > MAX_POS_X){\n            // add to bottom\n            bottomHeight = (count - i) * approximateElementHeight;\n            break;\n          } else if(!validateItem(datas[i],i)){\n            // item should not be displayed\n            continue;\n          } else {\n            // affiche a l'ecran\n            items.push(renderElement(datas[i], i));\n          }\n          pos += approximateElementHeight; // add an header\n\n      }\n\n      // add fakers and return all\n      items.unshift(<div id={id + '-top'} key={id + '-fake-start'} style={{height: topHeight}}></div>)\n      items.push(<div id={id + '-bottom'} key={id + '-fake-end'} style={{height: bottomHeight}}></div>)\n      return items;\n    }\n  }, [dataItems, scrollerRef.current, config, renderElement, refresh, validateItem]);\n  return renderList;\n}\n"],"names":["isFunction","obj","constructor","call","apply","BodyElement","getBoundingClientRect","document","body","addEventListener","type","cllbck","window","removeEventListener","__str__","Object","defineProperties","get","scrollY","documentElement","clientHeight","BODY_REF","current","TRUTHY","DEFAULT_OPTIONS","id","approximateElementHeight","overhead","assumeHeightIsConstant","useFakeList","datas","scrollerRef","renderElement","options","validateItem","React","useState","dataItems","setDataItems","refresh","setRefresh","config","approxHeight","useEffect","i","onScroll","Math","abs","scrollTop","renderList","useMemo","topPos","count","length","pos","topHeight","bottomHeight","items","MIN_POS_X","MAX_POS_X","origin","floor","push","unshift","height"],"mappings":"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"}