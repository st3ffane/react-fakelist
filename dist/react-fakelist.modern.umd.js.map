{"version":3,"file":"react-fakelist.modern.umd.js","sources":["../src/hook/is.function.js","../src/hook/fake.body.ref.js","../src/hook/useFakeList.js"],"sourcesContent":["// simple check for function type, inspired by lodash\nconst isFunction = (obj) => {\n  return !!(obj && obj.constructor && obj.call && obj.apply);\n}\nexport default isFunction;","// Fake body ref to ensure consistency\nconst BodyElement = {\n    // getBoundingClientRect: ()=>{\n    //   // returm document.documentElement datas\n    //   return document.body.getBoundingClientRect()\n    // },\n    addEventListener: (type, cllbck)=>{\n      window.addEventListener(type, cllbck);\n    },\n    removeEventListener:(type, cllbck)=>{\n      window.removeEventListener(type, cllbck);\n    },\n    __str__: 'Body Element'\n};\n\nObject.defineProperties(BodyElement, {\n  'scrollTop': {\n    get:()=> window.scrollY\n  },\n  'clientHeight': {\n    get:()=> document.documentElement.clientHeight\n  }\n});\nconst BODY_REF={\n  current: BodyElement\n}\nexport default BODY_REF;","// a Hook to fake large list\nimport React from \"react\";\nimport { useResizeDetector } from 'react-resize-detector';\nimport isFunction from './is.function';\nimport BODY_REF from './fake.body.ref';\nconst TRUTHY = ()=> true;\n\nconst DEFAULT_OPTIONS = {\n  id: 'fake-list', // a custom id, if used more than once in a page\n  approximateElementHeight: 80, // approximated height for a component\n  overhead: 3, // number of offscreen elements to draw\n  assumeHeightIsConstant: true, // if true, will precalculate position based on approximateElementHeight\n  // but will not be responsive. If set to false, let onResize event do **heavy** calculations\n}\n\nexport default function useFakeList(\n  datas = [], // full list to display\n  scrollerRef = BODY_REF, // the component that scroll, if undefined, will use window\n  renderElement, // a function taking datas element param for rendering\n  options = DEFAULT_OPTIONS, // some informations on elements,\n  validateItem = TRUTHY, // if return false, will not display this item\n) {\n  const [dataItems, setDataItems] = React.useState([]);\n  const [refresh, setRefresh] = React.useState(0); // will serve as refresher on scroll\n  const [config] = React.useState({...DEFAULT_OPTIONS, ...options});\n  const sizes = React.useRef([]); // real size of items\n\n  const setItemHeight = React.useCallback((i, h)=>{\n    sizes.current[i] = h;\n  },[]);\n  const approxHeight = config.approximateElementHeight;\n  React.useEffect(() => {\n    /* istanbul ignore else no work */\n    if (scrollerRef.current) {\n      // when ref got something, we can start drawing items\n      setDataItems(datas)\n    }\n  },[scrollerRef.current, datas]);\n  React.useEffect(()=>{\n    let i = 0;\n    let current = scrollerRef.current;\n    /* istanbul ignore if no work */\n    if(!current) return;\n    const onScroll = ()=>{\n      // if scroll more than approxHeight => redraw\n      /* istanbul ignore else no work */\n      if(Math.abs(current.scrollTop - i) > approxHeight){\n        i=current.scrollTop;\n        setRefresh(i);          \n      }\n        \n      };\n    current.addEventListener('scroll',onScroll);\n    return ()=>{\n      current.removeEventListener('scroll', onScroll)\n    }\n  },[scrollerRef.current, approxHeight]);\n  \n  const renderList = React.useMemo(()=>{\n    /* istanbul ignore else dummy users */\n    if(isFunction(renderElement) && scrollerRef.current){\n      const datas = dataItems || [];\n      // const scrollerSize = scrollerRef.current.getBoundingClientRect();\n      const {id, approximateElementHeight, overhead} = config;\n      \n      // simple: do all array and display on need\n      // if full window => top, if !fullWindow => scrollTop\n      let topPos =  - scrollerRef.current.scrollTop; \n      let count = datas.length;\n      let pos = topPos; // position of 1st element in pixels\n      let topHeight = 0; // heights of fakers div\n      let bottomHeight = 0;\n      let items = [];\n      const MIN_POS_X = - overhead * approximateElementHeight;\n      const MAX_POS_X = scrollerRef.current.clientHeight + overhead * approximateElementHeight;\n\n      // console.log(MAX_POS_X, scrollerRef.current.clientHeight,scrollerSize, scrollerRef.current.scrollTop);\n      let origin = 0;\n      // from refresh, assume we are constantSizeItem=true ---------------\n      if(config.assumeHeightIsConstant){\n        // calculate 1st index\n        origin = Math.floor( refresh / config.approximateElementHeight) - config.overhead;\n        origin = origin < 0 ? 0 : origin;\n        // add to top position\n        topHeight = origin * config.approximateElementHeight;\n        pos += topHeight;\n      } else {\n        // need to take onResize into account\n        \n      }      \n      // end of assuming --------------------------------------------------\n\n      for(let i=origin; i< count; i++){\n          const h = sizes.current[i] || approximateElementHeight;\n          if(pos + h < MIN_POS_X){\n            // add to top\n            topHeight += h;\n          } else if (pos > MAX_POS_X){\n            // add to bottom\n            bottomHeight = (count - i) * approximateElementHeight;\n            break;\n          } else if(!validateItem(datas[i],i)){\n            // item should not be displayed\n            continue;\n          } else {\n            // affiche a l'ecran\n            items.push(config.assumeHeightIsConstant\n            ? renderElement(datas[i], i) // render simply height constant element\n            : <Item key={'item-' + i} index={i} setItemHeight={setItemHeight}>{renderElement(datas[i], i)}</Item>); // add resize calculus\n          }\n          pos += h; // approximateElementHeight; // add an header\n\n      }\n\n      // add fakers and return all\n      items.unshift(<div id={id + '-top'} key={id + '-fake-start'} style={{height: topHeight}}></div>)\n      items.push(<div id={id + '-bottom'} key={id + '-fake-end'} style={{height: bottomHeight}}></div>)\n      return items;\n    }\n  }, [dataItems, scrollerRef.current, config, renderElement, refresh, validateItem, setItemHeight]);\n  return renderList;\n}\n\nconst Item = ({index, setItemHeight, children}) => {\n  const itemRef = React.useRef();\n  const onResize = React.useCallback((w,h)=>{\n    console.log('Resize',index, w, h);\n    setItemHeight(index, h)\n  },[index, setItemHeight]);\n  const {ref } = useResizeDetector({onResize, handleWidth: false});\n  \n  // React.useLayoutEffect(()=>{\n  //   // each time component render, set it's size in parent\n  //   if (itemRef.current && setItemHeight){\n  //     let height = itemRef.current.getBoundingClientRect().height;\n  //     setItemHeight(index, height)\n  //   }\n  // }, [ref.current, index, setItemHeight])\n  return <div ref={ref}>{children}</div>;\n}\n"],"names":["isFunction","obj","constructor","call","apply","BodyElement","addEventListener","type","cllbck","window","removeEventListener","__str__","Object","defineProperties","get","scrollY","document","documentElement","clientHeight","BODY_REF","current","TRUTHY","DEFAULT_OPTIONS","id","approximateElementHeight","overhead","assumeHeightIsConstant","useFakeList","datas","scrollerRef","renderElement","options","validateItem","React","useState","dataItems","setDataItems","refresh","setRefresh","config","sizes","useRef","setItemHeight","useCallback","i","h","approxHeight","useEffect","onScroll","Math","abs","scrollTop","renderList","useMemo","topPos","count","length","pos","topHeight","bottomHeight","items","MIN_POS_X","MAX_POS_X","origin","floor","push","unshift","height","Item","index","children","itemRef","onResize","w","console","log","useResizeDetector","handleWidth","ref"],"mappings":"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"}