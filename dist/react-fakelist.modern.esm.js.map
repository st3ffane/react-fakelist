{"version":3,"file":"react-fakelist.modern.esm.js","sources":["../src/hook/is.function.js","../src/hook/fake.body.ref.js","../src/hook/useFakeList.js"],"sourcesContent":["// simple check for function type, inspired by lodash\nconst isFunction = (obj) => {\n  return !!(obj && obj.constructor && obj.call && obj.apply);\n}\nexport default isFunction;","// Fake body ref to ensure consistency\nconst BodyElement = {\n    // getBoundingClientRect: ()=>{\n    //   // returm document.documentElement datas\n    //   return document.body.getBoundingClientRect()\n    // },\n    addEventListener: (type, cllbck)=>{\n      window.addEventListener(type, cllbck);\n    },\n    removeEventListener:(type, cllbck)=>{\n      window.removeEventListener(type, cllbck);\n    },\n    __str__: 'Body Element'\n};\n\nObject.defineProperties(BodyElement, {\n  'scrollTop': {\n    get:()=> window.scrollY\n  },\n  'clientHeight': {\n    get:()=> document.documentElement.clientHeight\n  }\n});\nconst BODY_REF={\n  current: BodyElement\n}\nexport default BODY_REF;","// a Hook to fake large list\nimport React from \"react\";\nimport { useResizeDetector } from 'react-resize-detector';\nimport isFunction from './is.function';\nimport BODY_REF from './fake.body.ref';\nconst TRUTHY = ()=> true;\n\nconst DEFAULT_OPTIONS = {\n  id: 'fake-list', // a custom id, if used more than once in a page\n  approximateElementHeight: 80, // approximated height for a component\n  overhead: 3, // number of offscreen elements to draw\n  assumeHeightIsConstant: true, // if true, will precalculate position based on approximateElementHeight\n  // but will not be responsive. If set to false, let onResize event do **heavy** calculations\n}\n\nexport default function useFakeList(\n  datas = [], // full list to display\n  scrollerRef = BODY_REF, // the component that scroll, if undefined, will use window\n  renderElement, // a function taking datas element param for rendering\n  options = DEFAULT_OPTIONS, // some informations on elements,\n  validateItem = TRUTHY, // if return false, will not display this item\n) {\n  const [dataItems, setDataItems] = React.useState([]);\n  const [refresh, setRefresh] = React.useState(0); // will serve as refresher on scroll\n  const [config] = React.useState({...DEFAULT_OPTIONS, ...options});\n  const sizes = React.useRef([]); // real size of items\n\n  const setItemHeight = React.useCallback((i, h)=>{\n    sizes.current[i] = h;\n  },[]);\n  const approxHeight = config.approximateElementHeight;\n  React.useEffect(() => {\n    /* istanbul ignore else no work */\n    if (scrollerRef.current) {\n      // when ref got something, we can start drawing items\n      setDataItems(datas)\n    }\n  },[scrollerRef.current, datas]);\n  React.useEffect(()=>{\n    let i = 0;\n    let current = scrollerRef.current;\n    /* istanbul ignore if no work */\n    if(!current) return;\n    const onScroll = ()=>{\n      // if scroll more than approxHeight => redraw\n      /* istanbul ignore else no work */\n      if(Math.abs(current.scrollTop - i) > approxHeight){\n        i=current.scrollTop;\n        setRefresh(i);          \n      }\n        \n      };\n    current.addEventListener('scroll',onScroll);\n    return ()=>{\n      current.removeEventListener('scroll', onScroll)\n    }\n  },[scrollerRef.current, approxHeight]);\n  \n  const renderList = React.useMemo(()=>{\n    /* istanbul ignore else dummy users */\n    if(isFunction(renderElement) && scrollerRef.current){\n      const datas = dataItems || [];\n      // const scrollerSize = scrollerRef.current.getBoundingClientRect();\n      const {id, approximateElementHeight, overhead} = config;\n      \n      // simple: do all array and display on need\n      // if full window => top, if !fullWindow => scrollTop\n      let topPos =  - scrollerRef.current.scrollTop; \n      let count = datas.length;\n      let pos = topPos; // position of 1st element in pixels\n      let topHeight = 0; // heights of fakers div\n      let bottomHeight = 0;\n      let items = [];\n      const MIN_POS_X = - overhead * approximateElementHeight;\n      const MAX_POS_X = scrollerRef.current.clientHeight + overhead * approximateElementHeight;\n\n      // console.log(MAX_POS_X, scrollerRef.current.clientHeight,scrollerSize, scrollerRef.current.scrollTop);\n      let origin = 0;\n      // from refresh, assume we are constantSizeItem=true ---------------\n      if(config.assumeHeightIsConstant){\n        // calculate 1st index\n        origin = Math.floor( refresh / config.approximateElementHeight) - config.overhead;\n        origin = origin < 0 ? 0 : origin;\n        // add to top position\n        topHeight = origin * config.approximateElementHeight;\n        pos += topHeight;\n      } else {\n        // need to take onResize into account\n        \n      }      \n      // end of assuming --------------------------------------------------\n\n      for(let i=origin; i< count; i++){\n          const h = sizes.current[i] || approximateElementHeight;\n          if(pos + h < MIN_POS_X){\n            // add to top\n            topHeight += h;\n          } else if (pos > MAX_POS_X){\n            // add to bottom\n            bottomHeight = (count - i) * approximateElementHeight;\n            break;\n          } else if(!validateItem(datas[i],i)){\n            // item should not be displayed\n            continue;\n          } else {\n            // affiche a l'ecran\n            items.push(config.assumeHeightIsConstant\n            ? renderElement(datas[i], i) // render simply height constant element\n            : <Item key={'item-' + i} index={i} setItemHeight={setItemHeight}>{renderElement(datas[i], i)}</Item>); // add resize calculus\n          }\n          pos += h; // approximateElementHeight; // add an header\n\n      }\n\n      // add fakers and return all\n      items.unshift(<div id={id + '-top'} key={id + '-fake-start'} style={{height: topHeight}}></div>)\n      items.push(<div id={id + '-bottom'} key={id + '-fake-end'} style={{height: bottomHeight}}></div>)\n      return items;\n    }\n  }, [dataItems, scrollerRef.current, config, renderElement, refresh, validateItem, setItemHeight]);\n  return renderList;\n}\n\nconst Item = ({index, setItemHeight, children}) => {\n  const itemRef = React.useRef();\n  const onResize = React.useCallback((w,h)=>{\n    console.log('Resize',index, w, h);\n    setItemHeight(index, h)\n  },[index, setItemHeight]);\n  const {ref } = useResizeDetector({onResize, handleWidth: false});\n  \n  // React.useLayoutEffect(()=>{\n  //   // each time component render, set it's size in parent\n  //   if (itemRef.current && setItemHeight){\n  //     let height = itemRef.current.getBoundingClientRect().height;\n  //     setItemHeight(index, height)\n  //   }\n  // }, [ref.current, index, setItemHeight])\n  return <div ref={ref}>{children}</div>;\n}\n"],"names":["isFunction","obj","constructor","call","apply","BodyElement","addEventListener","type","cllbck","window","removeEventListener","__str__","Object","defineProperties","get","scrollY","document","documentElement","clientHeight","BODY_REF","current","TRUTHY","DEFAULT_OPTIONS","id","approximateElementHeight","overhead","assumeHeightIsConstant","useFakeList","datas","scrollerRef","renderElement","options","validateItem","React","useState","dataItems","setDataItems","refresh","setRefresh","config","sizes","useRef","setItemHeight","useCallback","i","h","approxHeight","useEffect","onScroll","Math","abs","scrollTop","renderList","useMemo","topPos","count","length","pos","topHeight","bottomHeight","items","MIN_POS_X","MAX_POS_X","origin","floor","push","unshift","height","Item","index","children","itemRef","onResize","w","console","log","useResizeDetector","handleWidth","ref"],"mappings":"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"}